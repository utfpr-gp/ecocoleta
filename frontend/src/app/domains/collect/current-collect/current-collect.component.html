<p-panel class="col-12" header="Coletas Ativas e Avaliação">
    <p-table
        [value]="collects"
        [paginator]="true"
        [rows]="5"
        [loading]="loading"
        [totalRecords]="totalRecords"
        [lazy]="true"
        (onLazyLoad)="onLazyLoad($event)">
        <!--        (onLazyLoad)="loadCollects($event.first, $event.rows)">-->
        <ng-template pTemplate="header">
            <tr>
                <th>ID</th>
                <th>Status</th>
                <th>Data</th>
                <th class="fixed-column" style="min-width:8rem;">Ações</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-collect>
            <tr>
                <td>{{ collect.id }}</td>
                <td>{{ collect.status | statusTranslate }}</td>
                <td>{{ collect.createTime | date:'dd/MM/yy, hh:mm a' }}</td>
                <td class="fixed-column">
                    <!-- Botão Detalhes (visível para todos os usuários) -->
                    <button
                        pButton
                        class="p-button-rounded p-button-info p-button-sm mr-1"
                        icon="pi pi-info-circle"
                        (click)="openDetails(collect)"
                        title="Detalhes da Coleta"
                    ></button>

                    <!-- Botão de Continuar -->
                    <button
                        *ngIf="user?.role !== 'WASTE_COLLECTOR' && collect.status === 'PAUSED'"
                        pButton
                        class="p-button-rounded p-button-success p-button-sm mr-1"
                        icon="pi pi-play"
                        (click)="continueCollect(collect)"
                        title="Continuar Coleta"
                    ></button>

                    <!-- Botão de Pausar -->
                    <button
                        *ngIf="user?.role !== 'WASTE_COLLECTOR' && collect.status === 'PENDING'"
                        pButton
                        class="p-button-rounded p-button-warning p-button-sm mr-1"
                        icon="pi pi-pause"
                        (click)="pauseCollect(collect)"
                        title="Pausar Coleta"
                    ></button>

                    <!-- Botão de Avaliar -->
                    <button
                        *ngIf="user?.role !== 'WASTE_COLLECTOR' && collect.status === 'COMPLETED' && !collect.isEvaluated"
                        pButton
                        class="p-button-rounded p-button-info p-button-sm mr-1"
                        icon="pi pi-star"
                        (click)="evaluateCollect(collect)"
                        title="Avaliar Coleta"
                    ></button>

                    <!-- Botão de Cancelar -->
                    <button
                        *ngIf="user?.role !== 'WASTE_COLLECTOR' && collect.status !== 'COMPLETED'"
                        pButton
                        class="p-button-rounded p-button-danger p-button-sm mr-1"
                        icon="pi pi-times"
                        (click)="deleteCollect(collect)"
                        title="Cancelar Coleta"
                    ></button>
                </td>
            </tr>
        </ng-template>
    </p-table>
</p-panel>

<!--TODO TELA DAS COLETAS ATUAIS, LISTA AS COLETAS-->
<!-- ok lista em tabela as coletas, com coluna id, descrição = (data dd/mm/aaaa e hora), pausar coleta = (botão swap), ação (avaliar, deletar)-->
<!-- ok fazer pagina das atuais onde tras todas exeto cancelado e concluida ? modificar o ucriar metodo no back para trazer isso -->
<!-- ok pagina historico pode trazer todos os status e com filtragem por status e listagem-->
<!-- fazer botão de avaliar coleta, que abre um modal com um form de avaliação, com estrelas e comentario-->
<!-- Fluxo Geral
Tela 1: Coletas Ativas

Lista coletas com status PENDING, PAUSED, IN_PROGRESS e COMPLETED (não avaliadas).
Ações disponíveis: Continuar, Pausar, Avaliar, Cancelar.
Tela 2: Histórico

Lista coletas com status COMPLETED (avaliadas) e CANCELLED.
Permite filtrar por status e período.
Campos Adicionados:

isEvaluated: Identifica se a coleta foi avaliada.
rating: Armazena a pontuação (1-5 estrelas).-->

<p-dialog
    [(visible)]="detailsDialogVisible"
    [header]="'Detalhes da Coleta #' + selectedCollect?.id"
    [modal]="true"
    [responsive]="true"
    [style]="{ width: '50vw' }"
    [dismissableMask]="true"
    (onHide)="closeDetailsDialog()">
    <div *ngIf="selectedCollect">
        <p><strong>Status:</strong> {{ selectedCollect.status | statusTranslate }}</p>
        <p><strong>Data:</strong> {{ selectedCollect.createTime | date:'dd/MM/yy, hh:mm a' }}</p>
        <p><strong>Materiais:</strong></p>
        <ul>
            <li *ngFor="let material of selectedCollect.materials">
                {{ material }}
            </li>
        </ul>
        <p><strong>Quantidade de sacos:</strong> {{ selectedCollect.amount }}</p>
        <!-- Adicione mais campos conforme necessário -->
    </div>
</p-dialog>

<!--todo dialog de cancelar e confirmar-->
<p-dialog
    [(visible)]="cancelDialogVisible"
    [header]="'Cancelar Coleta #' + selectedCollect?.id"
    [modal]="true"
    [responsive]="true"
    [style]="{ width: '30vw' }"
    [dismissableMask]="true"
    (onHide)="closeCancelDialog()">
    <div *ngIf="selectedCollect">
        <p>Tem certeza de que deseja cancelar a coleta <strong>#{{ selectedCollect.id }}</strong>?</p>
        <div class="p-d-flex p-jc-end">
            <button pButton label="Cancelar" class="p-button-text" (click)="closeCancelDialog()"></button>
            <button pButton label="Confirmar" class="p-button-danger" (click)="confirmCancelCollect()"></button>
        </div>
    </div>
</p-dialog>


<!--todo dialog de pausar coleta-->
<p-dialog
    [(visible)]="pauseDialogVisible"
    [header]="'Pausar Coleta #' + selectedCollect?.id"
    [modal]="true"
    [responsive]="true"
    [style]="{ width: '30vw' }"
    [dismissableMask]="true"
    (onHide)="closePauseDialog()">
    <div *ngIf="selectedCollect">
        <p>Tem certeza de que deseja pausar a coleta <strong>#{{ selectedCollect.id }}</strong>?</p>
        <div class="p-d-flex p-jc-end">
            <button pButton label="Cancelar" class="p-button-text" (click)="closePauseDialog()"></button>
            <button pButton label="Confirmar" class="p-button-warning" (click)="confirmPauseCollect()"></button>
        </div>
    </div>
</p-dialog>


<!--todo dialog avaliar, essa fazer um componente separado para reutilizar no historico page-->
